import pandas as pd

# Load business datasets and tag with source
def load_and_tag(file_path, source_name):
    df = pd.read_csv(file_path)
    df['Source'] = source_name
    return df

df_lp = load_and_tag('/Users/yangyungchyi/Documents/Spring 2025/MIS 462/cleaned/LP-2.csv', 'LP')
df_llc = load_and_tag('/Users/yangyungchyi/Documents/Spring 2025/MIS 462/cleaned/LLC-2.csv', 'LLC')
df_gp = load_and_tag('/Users/yangyungchyi/Documents/Spring 2025/MIS 462/cleaned/GP-2.csv', 'GP')
df_corp = load_and_tag('/Users/yangyungchyi/Documents/Spring 2025/MIS 462/cleaned/Corp-2.csv', 'Corp')

# Load ZIP code dataset
df_zipcode = pd.read_csv('/Users/yangyungchyi/Documents/Spring 2025/MIS 462/BEData02092025/FairfaxZIP_Codes.csv')
df_zipcode['ZIPCODE'] = df_zipcode['ZIPCODE'].astype(str).str.strip()  # Ensure ZIP is string and clean

# Optional: filter only needed columns
keep_columns_zip = ['ZIPCODE', 'Shape__Area', 'Shape__Length']
df_zipcode = df_zipcode[keep_columns_zip]

# Combine all business datasets
business_df = pd.concat([df_lp, df_llc, df_gp, df_corp], ignore_index=True)
business_df['Zip'] = business_df['Zip'].astype(str).str.strip()  # Clean Zip codes

# Join on Zip
df_joined = pd.merge(business_df, df_zipcode, left_on='Zip', right_on='ZIPCODE', how='left')

# Filter out unmatched ZIPs
df_joined = df_joined[df_joined['ZIPCODE'].notna()]

# Drop original Zip column (optional)
df_joined.drop(columns=['Zip'], inplace=True)

# Save to CSV
local_filename = "0420.csv"
df_joined.to_csv(local_filename, index=False, encoding='utf-8-sig')
print(f"File saved locally as {local_filename}")
